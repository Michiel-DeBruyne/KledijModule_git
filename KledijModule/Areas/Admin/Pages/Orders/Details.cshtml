@page
@using KledijModule.Areas.Admin.Pages.Orders
@using ProjectCore.Domain.Entities.Bestellingen
@model DetailsModel
@{
    ViewData["Title"] = "Details";
}

<div>
    <div class="d-flex justify-content-end my-3 clearfix">
        <h3 class="me-auto">Details</h3>
        <a asp-page="#" hx-get="@Url.Page("Details","Edit")"
           hx-target="#modal-container" class="btn btn-dark me-1 edit-status"><i class="fa-solid fa-trash"></i> Update status (selected)</a>
    </div>
    <hr />
    <dl class="row">
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.OrderDetails.UserNaam)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.OrderDetails.UserNaam)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.OrderDetails.CreatedDate)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.OrderDetails.CreatedDate)
        </dd>
        <dt class="col-sm-2">
            @Html.DisplayNameFor(model => model.OrderDetails.TotaalPunten)
        </dt>
        <dd class="col-sm-10">
            @Html.DisplayFor(model => model.OrderDetails.TotaalPunten)
        </dd>
        <dd class="col-sm-12">
            <table class="table table-bordered">
                <thead class="thead-light">
                    <tr>
                        <th></th>
                        <th>Product</th>
                        <th>Hoeveelheid</th>
                        <th>Maat</th>
                        <th class="text-center">Punten</th>
                        <th class="text-center">Subtotaal</th>
                        <th class="text-center">Status</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var orderItem in Model.OrderDetails.OrderItems)
                    {
                        <tr>
                            @if (!(orderItem.OrderStatus == OrderStatus.Geannuleerd) || (orderItem.OrderStatus == OrderStatus.Retour))
                            {
                                <td><input type="checkbox" value="@orderItem.Id" /></td>
                            }
                            else
                            {
                                <td></td>
                            }
                            <td class="text-center">@orderItem.ProductNaam</td>
                            <td class="text-center">@orderItem.Hoeveelheid</td>
                            <td>@orderItem.Maat</td>
                            <td class="text-center">@orderItem.Punten punten</td>
                            <td class="text-center">
                                <strong>@((orderItem.Hoeveelheid * orderItem.Punten)) punten</strong>
                            </td>
                            <td class="text-center">@orderItem.OrderStatus</td>
                        </tr>
                    }
                </tbody>
                <tfoot>
                    <tr>
                        <td colspan="3" class="text-right">Totaal:</td>
                        <td class="text-right">
                            <strong>@Html.DisplayFor(model => model.OrderDetails.TotaalPunten) punten</strong>
                        </td>
                    </tr>
                </tfoot>
            </table>
        </dd>
    </dl>
</div>

<div id="modal-container"></div>

<script>
    document.addEventListener('htmx:beforeRequest', function (event) {
        // Check if the request was triggered by a button with the class 'edit-status'
        if (event.target.classList.contains('edit-status')) {
            // Count the number of selected checkboxes
            var selectedItems = document.querySelectorAll('input[type="checkbox"]:checked').length;

            // If no checkboxes are selected, prevent the request and show an alert
            if (selectedItems === 0) {
                event.preventDefault(); // Prevent the HTMX request
                alert('Je moet minstens één item selecteren om de status aan te passen.');
                return; // Exit the function
            }
        }
    });
</script>
